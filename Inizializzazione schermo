import pygame
import time
import math

pygame.init()
black = (0, 0, 0)
white = (255, 255, 255)
color = (255, 0, 0)
ampdiaframma = 1
lunghfocale = 1
dimsensore = 1
distmin = 0
screen = pygame.display.set_mode((700, 384))
pygame.display.set_caption("Show Text")
font = pygame.font.Font("freesansbold.ttf", 20)
changefont = pygame.font.Font("freesansbold.ttf", 16)
text = font.render("Start", True, white)
ampdiaframmatext = changefont.render("Ampiezza Diaframma: f/" + str(ampdiaframma),True, white)
lunghfocaletext = changefont.render("Lunghezza Focale: " + str(lunghfocale) + "mm",True, white)
dimsensoretext = changefont.render("Misura del Circolo di Confusione: " + str(dimsensore) + "mm",True, white)
distmintext = font.render("La distanza minima di messa a fuoco è: " + str(distmin) + "mm/" + str(distmin/10)+ "m",True, white)
distmintextRect = distmintext.get_rect()
distmintextRect.center = (341, 280)
dimsensoretextRect = dimsensoretext.get_rect()
dimsensoretextRect.center = (341, 200)
lunghfocaletextRect = lunghfocaletext.get_rect()
lunghfocaletextRect.center = (341, 120)
ampdiaframmatextRect = ampdiaframmatext.get_rect()
ampdiaframmatextRect.center = (341, 40)
textRect = text.get_rect()
textRect.center = (341, 192)
mouse_pos = pygame.mouse.get_pos()
inpututente = ""
backspacepressed = False
returnpressed = False
startpressed = False
changeampdiaframma = False
newampdiaframma = ""
newlunghfocale = ""
changelunghfocale = False
changedimsensore = False
newdimsensore = ""

def calcolo():                                                                          
    global ampdiaframma
    global dimsensore
    global lunghfocale
    global distmin
    distmin = round(((lunghfocale**2)/(ampdiaframma*dimsensore)), 3)
def controlloclick():
    global text
    global mouse_pos
    global startpressed
    global ampdiaframma
    global dimsensore
    global changeampdiaframma
    global changelunghfocale
    global changedimsensore
    global ampdiaframmaRect
    global ampdiaframmaansRect
    global lunghfocaleRect
    global dimsensoreRect
    get_text()
    if pygame.mouse.get_pressed()[0] and textRect.collidepoint(mouse_pos):
        startpressed = True
        screen.fill(black)
    elif pygame.mouse.get_pressed()[0] and ampdiaframmaRect.collidepoint(mouse_pos):
        changeampdiaframma = True
    elif pygame.mouse.get_pressed()[0] and lunghfocaleRect.collidepoint(mouse_pos):
        changelunghfocale = True
    elif pygame.mouse.get_pressed()[0] and dimsensoreRect.collidepoint(mouse_pos):
        changedimsensore = True


def update():

    pygame.display.flip()
    controlloclick()
    calcolo()
    get_text()


def get_text():
    global ampdiaframma
    global lunghfocale
    global dimsensore
    global startpressed
    global color
    global changeampdiaframma
    global changelunghfocale
    global changedimsensore
    global ampdiaframmaRect
    global ampdiaframmaansRect
    global newampdiaframma
    global lunghfocaleRect
    global lunghfocaleansRect
    global newlunghfocale
    global dimsensoreRect
    global dimsensoreansRect
    global newdimsensore
    global inpututente
    global backspacepressed
    global returnpressed
    ampdiaframmatext = changefont.render("Ampiezza Diaframma: f/" + str(ampdiaframma) , True, white)
    lunghfocaletext = changefont.render("Lunghezza Focale: " + str(lunghfocale) + "mm",True, white)
    dimsensoretext = changefont.render("Misura del Circolo di Confusione: " + str(dimsensore) + "mm",True, white)
    distmintext = font.render("La distanza minima di messa a fuoco è: " + str(distmin) + "mm/" + str(round((distmin/1000),3)) + "m" ,True, white)
    if startpressed == False and changelunghfocale == False and changeampdiaframma == False and changedimsensore == False:
        screen.blit(text, textRect)
    elif startpressed == True and changelunghfocale == False and changeampdiaframma == False and changedimsensore == False:
        screen.blit(ampdiaframmatext, ampdiaframmatextRect)
        ampdiaframmaRect = pygame.draw.rect(screen, black, pygame.Rect(600, 10, 60, 60))
        changetext = changefont.render("Cambia", True, white)
        changetextRect = changetext.get_rect()
        changetextRect.center = (630, 40)
        screen.blit(changetext, changetextRect)
        screen.blit(lunghfocaletext, lunghfocaletextRect)
        lunghfocaleRect = pygame.draw.rect(screen, black, pygame.Rect(600, 90, 60, 60))
        changetext2 = changefont.render("Cambia", True, white)
        changetext2Rect = changetext2.get_rect()
        changetext2Rect.center = (630, 120)
        screen.blit(changetext2, changetext2Rect)
        screen.blit(dimsensoretext, dimsensoretextRect)
        dimsensoreRect = pygame.draw.rect(screen, black, pygame.Rect(600, 170, 60, 60))
        changetext3 = changefont.render("Cambia", True, white)
        changetext3Rect = changetext3.get_rect()
        changetext3Rect.center = (630, 200)
        screen.blit(changetext3, changetext3Rect)
        screen.blit(distmintext, distmintextRect)
    elif changeampdiaframma == True:
        screen.fill(black)
        if backspacepressed == True:
            newampdiaframma = newampdiaframma[:-1]
            backspacepressed = False
        newampdiaframma = newampdiaframma + inpututente
        inpututente = ""
        ampdiaframmaans = changefont.render("Inserire nuova ampiezza del diaframma: " + str(newampdiaframma),True, white)
        ampdiaframmaansRect = ampdiaframmaans.get_rect()
        ampdiaframmaansRect.center = (350, 192)
        screen.blit(ampdiaframmaans, ampdiaframmaansRect)
        if returnpressed == True:
            if newampdiaframma == "":
                ampdiaframma = 1
            else:
                ampdiaframma = float(newampdiaframma)
            changeampdiaframma = False
            returnpressed = False
            screen.fill(black)
    elif changelunghfocale == True:
        screen.fill(black)
        if backspacepressed == True:
            newlunghfocale = newlunghfocale[:-1]
            backspacepressed = False
        newlunghfocale = newlunghfocale + inpututente
        inpututente = ""
        lunghfocaleans = changefont.render("Inserire nuova lungezza focale: " + str(newlunghfocale) + "mm",True, white)
        lunghfocaleansRect = lunghfocaleans.get_rect()
        lunghfocaleansRect.center = (350, 192)
        screen.blit(lunghfocaleans, lunghfocaleansRect)
        if returnpressed == True:
            if newlunghfocale == "":
                lunghfocale = 0
            else:
                lunghfocale = float(newlunghfocale)
            changelunghfocale = False
            returnpressed = False
            screen.fill(black)
    elif changedimsensore == True:
        screen.fill(black)
        if backspacepressed == True:
            newdimsensore = newdimsensore[:-1]
            backspacepressed = False
        newdimsensore = newdimsensore + inpututente
        inpututente = ""
        dimsensoreans = changefont.render("Inserire nuova dimensione del sensore: " + str(newdimsensore) + "mm",True, white)
        dimsensoreansRect = dimsensoreans.get_rect()
        dimsensoreansRect.center = (350, 192)
        screen.blit(dimsensoreans, dimsensoreansRect)
        if returnpressed == True:
            if newdimsensore == "":
                dimsensore = 1
            else:
                dimsensore = float(newdimsensore)
            changedimsensore = False
            returnpressed = False
            screen.fill(black)


while True:

    for event in pygame.event.get():
        if event.type == pygame.QUIT:
            pygame.quit()
        elif event.type == pygame.KEYDOWN:
            if event.key == pygame.K_0:
                inpututente = "0"
            elif event.key == pygame.K_1:
                inpututente = "1"
            elif event.key == pygame.K_2:
                inpututente = "2"
            elif event.key == pygame.K_3:
                inpututente = "3"
            elif event.key == pygame.K_4:
                inpututente = "4"
            elif event.key == pygame.K_5:
                inpututente = "5"
            elif event.key == pygame.K_6:
                inpututente = "6"
            elif event.key == pygame.K_7:
                inpututente = "7"
            elif event.key == pygame.K_8:
                inpututente = "8"
            elif event.key == pygame.K_9:
                inpututente = "9"
            elif event.key == pygame.K_PERIOD:
                inpututente = "."
            elif event.key == pygame.K_BACKSPACE:
                backspacepressed = True
            elif event.key == pygame.K_RETURN:
                returnpressed = True
        mouse_pos = pygame.mouse.get_pos()
        update()
